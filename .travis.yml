sudo: required

services:
    - docker

before_install:
    - ls -la
    - openssl aes-256-cbc -K $encrypted_898c097730ba_key -iv $encrypted_898c097730ba_iv -in sign-key.enc -out sign-key -d
    - docker pull pritunl/archlinux
    - sudo chown 1000:1000 -R ${PWD}
    - docker run --name eloquentos -itd -v ${PWD}:/mnt pritunl/archlinux /bin/bash
    - docker exec eloquentos /bin/sh -c "cd /mnt && ./travis.sh"
    - docker exec -u eloquentos eloquentos /bin/sh -c "gpg --allow-secret-key-import --import /mnt/sign-key"

script: docker exec -u eloquentos eloquentos /bin/sh -c "cd /mnt && ./build.sh"

after_success:
    - sudo chown travis:travis -R ${PWD}
    - ls -la

before_deploy: git fetch --tags

after_success:
    - sudo apt-get install -y sshpass
    - ./deploy-testing.sh
